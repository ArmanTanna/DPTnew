@model IEnumerable<DPTnew.Models.UpdateCase>

@{
    ViewBag.Title = "Case Management";
}

@section Scripts {
    <link href="~/Content/jquery-ui.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-ui.min.js"></script>
    <script type="text/javascript">
        var yourApp = yourApp || {};
        yourApp.Urls = yourApp.Urls || {};
        yourApp.Urls.baseUrl = '@Url.Content("~")';

        function submitform() {
            if ($("#item_Description").val() == "" || $("#item_Details").val() == "") {
                var $psw = $("#errmsg");
                $psw.text("");
                $psw.text("Please fill out Description and details fields!");
                var pwdDialogConfig = {
                    modal: true,
                    width: 400,
                    height: 250,
                    buttons: {
                        OK: function () {
                            $(this).dialog("close");
                        }
                    }
                };
                $("#sysmsg-dialog").dialog(pwdDialogConfig);
            }
            else
                $.post("/Case/Update", {
                    CaseId: $("input[name=id]").val(),
                    Description: $("#item_Description").val(),
                    Details: $("#item_Details").val()
                },
                function (result) {
                    $("#caseRowID").val(result.split("_")[0]);
                    $("#casehID").val(result.split("_")[1]);
                    $("#msg").val("History case has been saved correctly!");
                    $("#msgConfirm").val("Choose file or click on Submit");
                    var pwdDialogConfig = {
                        modal: true,
                        width: 400,
                        height: 350
                        //buttons: {
                        //    OK: function () {
                        //        $(this).dialog("close");
                        //    }
                        //}
                    };
                    $("#fileupload-dialog").dialog(pwdDialogConfig);
                });
        }

        $(document).ready(function () {
        });
    </script>
}

<table id="dptcase" class="display" cellspacing="0" width="100%">
    <thead>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@Html.DisplayNameFor(model => model.CaseId)</td>
                <td>
                    <input type="number" name="id" value="@Html.DisplayFor(modelItem => item.CaseId)" readonly>
                </td>
            </tr>
            <tr>
                <td>@Html.DisplayNameFor(model => model.Description)</td>
                <td>
                    @Html.TextAreaFor(modelItem => item.Description, new { @cols = 350, @rows = 1, @required = "required" })
                    @*<input type="email" name="description" value="@Html.DisplayFor(modelItem => item.Description)" readonly>*@
                </td>
            </tr>
            <tr>
                <td>@Html.DisplayNameFor(model => model.Details)</td>
                <td>
                    @Html.TextAreaFor(modelItem => item.Details, new { @cols = 350, @rows = 8, @required = "required" })
                </td>
            </tr>
            <tr>
                <td><a href="javascript: submitform()">Submit</a></td>
            </tr>
        }
    </tbody>
</table>
<div id="fileupload-dialog" title="Upload File" style="display: none;">
    @using (Html.BeginForm("UploadHistoryFile", "Case", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        <input type="text" name="msg" id="msg" readonly />

        <input type="text" name="msgConfirm" id="msgConfirm" readonly />

        <label for="caseRowID">Case ID: </label>

        <input type="text" name="caseRowID" id="caseRowID" readonly />

        <label for="casehID">Case History ID: </label>

        <input type="text" name="casehID" id="casehID" readonly />

        <input type="file" name="file" id="file" accept=".zip,.rar" />

        <input type="submit" />
    }
</div>
<div id="sysmsg-dialog" title="System message" style="display:none;">
    <strong style="position:absolute; margin-top:20px;" id="errmsg"></strong>
</div>
