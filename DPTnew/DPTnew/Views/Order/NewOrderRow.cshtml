@model IEnumerable<DPTnew.Models.Order>

@{
    ViewBag.Title = "Orders";
}

@section Scripts {
    <link href="~/Content/jquery-ui.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-ui.min.js"></script>
    <script type="text/javascript">
        var yourApp = yourApp || {};
        yourApp.Urls = yourApp.Urls || {};
        yourApp.Urls.baseUrl = '@Url.Content("~")';

        var companies = JSON.parse(atob('@ViewBag.Companies'));
        function submitform() {
                $.post("/Order/Insert", {
                    AccountName: $("#accountName-choice").val()                    
                },
                function (result) {
                    var $psw = $("#msg");
                    $psw.text("");
                    $psw.text(result);
                    var pwdDialogConfig = {
                        modal: true,
                        width: 400,
                        height: result ? 250 : "auto",
                        buttons: {
                            OK: function () {
                                $(this).dialog("close");
                                //location.reload();
                            }
                        }
                    };
                    $("#sysmsg-dialog").dialog(pwdDialogConfig);
                });
        }

        $(document).ready(function () {
            for (var i = 0; i < companies.length; i++) {
                $("#accountName-choice").append('<option value="' + companies[i].split("\"")[0].substring(0, companies[i].length - 1) + '">' + companies[i] + '</option>');
            }

            $("#accountName-choice").change(function () {
                $("#contact-choice").empty();
                $.post(yourApp.Urls.GetContacts, { companyName: $("#accountName-choice").val() },
                     function (result) {
                         for (var i = 0; i < result.length; i++) {
                             $("#contact-choice").append("<option value='" + result[i].Email + "'>" + result[i].Email + "</option>");
                         }
                     });
            });
        });
    </script>
}

<table id="dptorder" class="display" cellspacing="0" width="100%">
    <thead>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@Html.DisplayNameFor(model => model.AccountName)</td>
                <td>
                    <select name="accountName" id="accountName-choice">
                        <option selected value="@Html.DisplayFor(modelItem => item.AccountName)">@Html.DisplayFor(modelItem => item.AccountName)</option>
                    </select>
                </td>
                @*<td>@Html.DisplayNameFor(model => model.Contact)</td>
                <td>
                    <select name="contact" id="contact-choice">
                        <option selected value="@Html.DisplayFor(modelItem => item.Contact)">@Html.DisplayFor(modelItem => item.Contact)</option>
                    </select>
                </td>*@
            </tr>
            <tr>
                <td><a href="javascript: submitform()"><input type="submit" value="Submit" /></a></td>
            </tr>
        }
    </tbody>
</table>
<div id="sysmsg-dialog" title="System message" style="display:none;">
    <strong style="position:absolute; margin-top:20px;" id="errmsg"></strong>
</div>
