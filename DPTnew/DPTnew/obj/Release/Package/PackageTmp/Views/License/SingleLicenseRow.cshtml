@model IEnumerable<DPTnew.Models.LicenseView>

@{
    ViewBag.Title = "Modify";
}


@section Scripts {

    <script type="text/javascript">

        var yourApp = yourApp || {};
        yourApp.Urls = yourApp.Urls || {};
        yourApp.Urls.baseUrl = '@Url.Content("~")';
        yourApp.Urls.ModifyUrl = '@Url.Action("Modify", "License")';

        var companies = JSON.parse(atob('@ViewBag.Companies'));

        function submitform() {
            $(this).find('button[type="submit"]').attr('disabled', 'disabled');
            setTimeout(function () {
                $(this).find('button[type="submit"]').attr('disabled', 'disabled');
            }, 4000);
            $.post("/License/Modify", {
                AccountNumber: $("#accountName-choice").val(),
                LicenseID: $("input[name=licenseID]").val(),
                ProductName: $("input[name=productName]").val(),
                ArticleDetail: $("input[name=articleDetail]").val(),
                LicenseType: $("input[name=licenseType]").val(),
                Quantity: $("input[name=quantity]").val(),
                MachineID: $("input[name=machineID]").val(),
                Version: $("input[name=version]").val(),
                Note: $("input[name=note]").val(),
                ExportedNum: $("input[name=exportedNum]").val(),
                MaxExport: $("input[name=maxExport]").val(),
            },
            function (result) {
                var $psw = $("#msg");
                $psw.text("");
                $psw.text(result);
                var pwdDialogConfig = {
                    modal: true,
                    width: 400,
                    height: result ? 250 : "auto",
                    buttons: {
                        OK: function () {
                            $(this).dialog("close");
                            //location.reload();
                        }
                    }
                };
                $("#sysmsg-dialog").dialog(pwdDialogConfig);
            });
        }

    </script>
    <link href="~/Content/jquery-ui.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-ui.min.js"></script>
    <script type="text/javascript">
        var yourApp = yourApp || {};
        yourApp.Urls = yourApp.Urls || {};
        yourApp.Urls.baseUrl = '@Url.Content("~")';

        $(document).ready(function () {
            for (var i = 0; i < companies.length; i++) {
                $("#accountName-choice").append('<option value="' + companies[i].split("\"")[1].substring(0, companies[i].length - 1) + '">' + companies[i] + '</option>');
            }
        });
    </script>
}

@foreach (var item in Model)
{
    <div class="editor-label" style="font-size: 1.2em;">
        @Html.DisplayNameFor(model => model.AccountName)
    </div>
    <div class="editor-field">
        <select name="accountName" id="accountName-choice">
            <option selected value="@Html.DisplayFor(modelItem => item.AccountName)">@Html.DisplayFor(modelItem => item.AccountName)</option>
        </select>
    </div>
}
<table id="dptLicense" class="display" cellspacing="0" width="100%">
    <thead>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@Html.DisplayNameFor(model => model.LicenseID)</td>
                <td>
                    <input type="text" name="licenseID" value="@Html.DisplayFor(modelItem => item.LicenseID)" readonly>
                </td>
                <td>@Html.DisplayNameFor(model => model.ProductName)</td>
                <td>
                    <input type="text" name="productName" value="@Html.DisplayFor(modelItem => item.ProductName)" readonly>
                </td>
            </tr>
            <tr>
                <td>@Html.DisplayNameFor(model => model.ArticleDetail)</td>
                <td>
                    <input type="text" name="articleDetail" value="@Html.DisplayFor(modelItem => item.ArticleDetail)" readonly>
                </td>
                <td>@Html.DisplayNameFor(model => model.LicenseType)</td>
                <td>
                    <input type="text" name="licenseType" value="@Html.DisplayFor(modelItem => item.LicenseType)" readonly>
                </td>
            </tr>
            <tr>
                <td>@Html.DisplayNameFor(model => model.Quantity)</td>
                <td>
                    <input type="number" name="quantity" value="@Html.DisplayFor(modelItem => item.Quantity)">
                </td>
                <td>@Html.DisplayNameFor(model => model.MachineID)</td>
                <td>
                    <input type="text" name="machineID" value="@Html.DisplayFor(modelItem => item.MachineID)" readonly>
                </td>
            </tr>
            <tr>
                <td>@Html.DisplayNameFor(model => model.Version)</td>
                <td>
                    <input type="text" name="version" value="@Html.DisplayFor(modelItem => item.Version)" readonly>
                </td>
                <td>@Html.DisplayNameFor(model => model.Note)</td>
                <td>
                    <input type="text" name="note" value="@Html.DisplayFor(modelItem => item.Note)" readonly>
                </td>
            </tr>
            <tr>
                <td>@Html.DisplayNameFor(model => model.ExportedNum)</td>
                <td>
                    <input type="number" name="exportedNum" value="@Html.DisplayFor(modelItem => item.ExportedNum)" readonly>
                </td>
                <td>@Html.DisplayNameFor(model => model.MaxExport)</td>
                <td>
                    <input type="number" name="maxExport" min="0" max="1000" step="1" value="@Html.DisplayFor(modelItem => item.MaxExport)" readonly>
                </td>
            </tr>
        }
    </tbody>
</table>
<p>
    <button name='submit' onclick="javascript: submitform()">@DPTnew.Localization.Resource.Submit </button>
    <button name='close' onclick="javascript: window.open('', '_self').close()">@DPTnew.Localization.Resource.Close </button>
    @*<a href="javascript: submitform()"><input type="submit" value="@DPTnew.Localization.Resource.Submit" /></a>
        <a href="javascript:window.open('','_self').close();"><input type="submit" value="@DPTnew.Localization.Resource.Close" /></a>*@
</p>
<div id="sysmsg-dialog" title="System message" style="display:none;">
    <strong style="position:absolute; margin-top:20px;" id="msg"></strong>
</div>
